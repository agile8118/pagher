<script>

  // Buttons won't get focused on click
  document.addEventListener("click", function (e) {
    if (document.activeElement.toString() == "[object HTMLButtonElement]") {
      document.activeElement.blur();
    }
  });

  if (window.location.href.indexOf("new-page") > -1) {
    document.querySelectorAll(".js--create-page").forEach(function (el) {
      el.classList.add("display-none")
    })
  }

  if (localStorage.getItem("theme") === "dark") {
    changeTheme("dark");
  } else {
    changeTheme("light");
  }

  document.querySelectorAll(".js--themeSwitch").forEach(function (elem) {
    elem.addEventListener('change', (event) => {
      if (event.target.checked) {
        changeTheme("dark");
      } else {
        changeTheme("light");
      }
    })
  });


  function changeTheme(theme) {
    if (theme === "dark") {
      var link = document.createElement("link");
      link.setAttribute("rel", "stylesheet");
      link.setAttribute("href", "/dark-style.css");
      document.querySelector("head").appendChild(link)
      document.querySelectorAll(".js--themeSwitch").forEach(function (elem) {
        elem.checked = true
      });
      document.querySelector("#pagherLogoSm").src = "/images/pagher-logo-light.svg";
      document.querySelector("#pagherLogoMd").src = "/images/pagher-logo-light.svg";
      localStorage.setItem("theme", "dark");
    }

    if (theme === "light") {
      if (document.querySelectorAll("link[href='/dark-style.css']")[0]) {
        document.querySelector("head").removeChild(document.querySelectorAll("link[href='/dark-style.css']")[0]);
        document.querySelectorAll(".js--themeSwitch").forEach(function (elem) {
          elem.checked = false
        });
        document.querySelector("#pagherLogoSm").src = "/images/pagher-logo.svg";
        document.querySelector("#pagherLogoMd").src = "/images/pagher-logo.svg";
        localStorage.setItem("theme", "light");
      }
    }
  }


  // If user profile image couldn't render, then show user placeholer default image
  var userImages = document.querySelectorAll(".js--user-image")
  for (var i = 0; i < userImages.length; i++) {
    userImages[i].addEventListener('error', function (e) {
      e.target.src = "/images/users/placeholder.png";
    })
  }

  function sidenavTogglerClicked(e) {
    if (document
      .querySelector("#js--sidenav").classList.contains("sidenav--open")) {
      // Close the side navigation
      document.querySelector("body").style.marginLeft = "0";
      document
        .querySelector("#js--sidenav")
        .classList.remove("sidenav--open");
      document
        .querySelector("#js--sidenav")
        .classList.add("sidenav--close");
    } else {
      // Open the side navigation
      document.querySelector("body").style.marginLeft = "24rem";
      document
        .querySelector("#js--sidenav")
        .classList.add("sidenav--open");
      document
        .querySelector("#js--sidenav")
        .classList.remove("sidenav--close");
    }
  }

  function navDropdownClicked() {
    document
      .querySelectorAll(".nav-dropdown__content").forEach(function (el) {
        el.classList.toggle("display-none");
      })
    document.querySelectorAll(".nav-dropdown__button").forEach(function (el) {
      el.classList.toggle("nav-dropdown__button--active");
    })
  }

  function navOpenerClicked() {
    var navItems = document.querySelector(".navigation-sm__hidden");
    if (navItems.classList[1] === "display-none") {
      navItems.classList.remove("display-none");
    } else {
      navItems.classList.add("display-none");
    }
  }

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function () {
    if (this.status === 200) {
      try {
        document.querySelectorAll(".js--user-image")[0].src = JSON.parse(
          this.response
        ).user.photo;

        document.querySelectorAll(".js--user-image")[1].src = JSON.parse(
          this.response
        ).user.photo;
      } catch (e) { }
      document
        .querySelector("#js--nav-dropdown-md")
        .classList.remove("display-none");
      document
        .querySelector("#js--nav-dropdown-sm")
        .classList.remove("display-none");
      document.querySelector("#js--login-md").classList.add("display-none");
      document.querySelector("#js--login-sm").classList.add("display-none");
    } else if (this.status === 401) {
      document.querySelectorAll(".js--create-page")[0].href =
        "/login?redirected=new-page";
      document.querySelectorAll(".js--create-page")[1].href =
        "/login?redirected=new-page";
      document
        .querySelector("#js--nav-dropdown-sm")
        .classList.add("display-none");
      document
        .querySelector("#js--nav-dropdown-sm")
        .classList.add("display-none");
      document.querySelector("#js--login-md").classList.remove("display-none");
      document.querySelector("#js--login-sm").classList.remove("display-none");
    }
  };
  xhttp.open("POST", "/auth", true);
  xhttp.setRequestHeader("authorization", localStorage.getItem("token"));
  xhttp.send();
</script>